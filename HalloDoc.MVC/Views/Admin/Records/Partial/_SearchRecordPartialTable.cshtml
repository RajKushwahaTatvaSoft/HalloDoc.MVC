@model PagedList<SearchRecordTRow>
<div class="table-responsive mt-3 d-none d-md-block" style="height:400px;">
    <table class="table admin-dashboard">

        <thead class="table-head align-middle">

            <tr>
                <th style="text-align: center;">Patient Name</th>
                <th style="text-align: center;">Requestor</th>
                <th style="text-align: center;">Date Of Service</th>
                <th style="text-align: center;">Close Case Date</th>
                <th style="text-align: center;">Email</th>
                <th style="text-align: center;">Phone Number</th>
                <th style="text-align: center;">Address</th>
                <th style="text-align: center;">Zip</th>
                <th style="text-align: center;">Request Status</th>
                <th style="text-align: center;">Physician</th>
                <th style="text-align: center;">Physician Note</th>
                <th style="text-align: center;">Cancelled By Provider Note</th>
                <th style="text-align: center;">Admin Note</th>
                <th style="text-align: center;">Patient Note</th>
                <th style="text-align: center;">Delete Permanently</th>
            </tr>

        </thead>

        <tbody class="align-middle" id="dashboard-table-body">

            @foreach (var record in Model)
            {
                <tr>
                    <td>@record.PatientName</td>
                    <td>@record.Requestor</td>
                    <td>@record.DateOfService</td>
                    <td>@record.CloseCaseDate</td>
                    <td>@record.Email</td>
                    <td>@record.PhoneNumber</td>
                    <td>@record.Address</td>
                    <td>@record.Zip</td>
                    <td>@record.RequestStatus</td>
                    <td>@record.Physician</td>
                    <td>@record.PhysicianNote</td>
                    <td>@record.CancelledByPhysicianNote</td>
                    <td>@record.AdminNote</td>
                    <td>@record.PatientNote</td>
                    <td>

                        <button type="button" data-requestid="@record.RequestId" class="btn btn-outline-info delete-request align-middle">
                            <span class="text-info">Delete</span>
                        </button>

                    </td>
                </tr>
            }
        </tbody>

    </table>
</div>

<div class="pagination d-flex justify-content-center align-content-center mt-3">

    @{
        int previousPage = Model.CurrentPage - 1;
        int nextPage = Model.CurrentPage + 1;
        int buttonNextToCurrent = 1;
        int buttonsToRenderPrevious = (Model.CurrentPage - 2);
        int buttonsToRenderNext = (Model.TotalPages - Model.CurrentPage) - 1;
    }

    @* TO GO FOR EXTRA WE CAN SHOW ALL BUTTON IF TOTAL PAGE IS LESS THAN SOME THRESHOLD LIKE 10 *@

    @if (Model.HasPrevious)
    {
        <button class="page-item mx-1 border-0" onclick="loadSearchRecordTable(@previousPage)">❮</button>

        if (buttonsToRenderPrevious <= (buttonNextToCurrent + 1))
        {
            for (int i = 1; i <= previousPage; i++)
            {
                <button class="page-item mx-1 border-0" onclick="loadSearchRecordTable(@i)">@i</button>
            }
        }
        else
        {
            <button class="border-0 mx-1 page-item" onclick="loadSearchRecordTable(1)">1</button>
            <button class="border-0 mx-1 page-item">...</button>
            for (int i = (Model.CurrentPage - buttonNextToCurrent); i <= previousPage; i++)
            {
                <button class="page-item mx-1 border-0" onclick="loadSearchRecordTable(@i)">@i</button>
            }
        }
    }
    else
    {
        <button class="page-item mx-1 border-0 disabled">❮</button>
    }

    <button class="page-item mx-1 active border-0">@Model.CurrentPage</button>

    @if (Model.HasNext)
    {

        if (buttonsToRenderNext <= (buttonNextToCurrent + 1))
        {
            for (int i = nextPage; i <= Model.TotalPages; i++)
            {
                <button class="page-item mx-1 border-0" onclick="loadSearchRecordTable(@i)">@i</button>
            }
        }
        else
        {
            for (int i = nextPage; i <= (Model.CurrentPage + buttonNextToCurrent); i++)
            {
                <button class="page-item mx-1 border-0" onclick="loadSearchRecordTable(@i)">@i</button>
            }
            <button class="border-0 mx-1 page-item">...</button>
            <button class="border-0 mx-1 page-item" onclick="loadSearchRecordTable(@Model.TotalPages)">@Model.TotalPages</button>
        }

        <button class="page-item mx-1 border-0" onclick="loadSearchRecordTable(@nextPage)">❯</button>

    }
    else
    {
        <button class="page-item mx-1 border-0 disabled">❯</button>
    }

</div>

<script>

    $('.delete-request').click(function () {
        let rId = $(this).data("requestid");

        $('#delete-modal-request-id').val(rId);

        $('#deleteRequestModal').modal('show');
    });

    $('#delete-request-submit-btn').click(function () {

        $.ajax({
            url: "/Admin/DeleteRequest",
            data: { requestId: $('#delete-modal-request-id').val() },
            type: 'POST',
            success: function (result) {
                if (result) {
                    loadSearchRecordTable(@Model.CurrentPage);
                    $('#deleteRequestModal').modal('hide');
                }
            },
            error: function (error) {
                console.log(error);
                alert('Error Cancelling Request')
            },
        });

    });
</script>