@model ViewCaseViewModel
@{
    Layout = "_AdminDashboardLayout";
    ViewData["UserName"] = Model.UserName;
}

@* Assign Case *@
<div class="modal fade" id="assignModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-info">
                <div class="modal-dark modal-title text-white" id="exampleModalLongTitle">
                    Assign Request
                </div>
                <button type="button" class="btn" aria-label="Close" data-bs-dismiss="modal">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"
                         fill="#FFFFFF">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z" />
                    </svg>
                </button>
            </div>
            <form method="post">
                <div class="modal-body">
                    <span class="modal-head">To assign this request, search and select another Physician</span>
                    <div class="modal-flex my-3">

                        <input asp-for="RequestId" id="assignCaseRequestId" hidden />
                        <div class="form-floating mt-3">
                            <select class="form-select" id="assignCaseRegion">
                                <option disabled selected value="0"> -- select region -- </option>

                                @foreach (var region in Model.regions)
                                {
                                    <option value="@region.Regionid">@region.Name</option>
                                }
                            </select>
                            <label for="assignCaseRegion">Narrow Search By Region</label>
                        </div>


                        <div class="form-floating mt-3">
                            <select class="form-select" id="assignCasePhysician">
                                <option disabled selected value="0"> -- select physician -- </option>

                                @foreach (var physician in Model.physicians)
                                {
                                    <option value="@physician.Physicianid">@physician.Firstname @physician.Lastname</option>
                                }
                            </select>
                            <label for="assignCasePhysician">Select Physician</label>
                        </div>

                        <div class="form-floating mt-3">
                            <textarea style="height: 100px;" type="text" class="form-control" id="assignCaseNotes"></textarea>
                            <label for="assignCaseNotes">Description</label>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" id="assign-modal-submit-btn" class="btn btn-info text-white" data-bs-dismiss="modal">Submit</button>
                    <button type="button" class="btn cancel-btn" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>


@* Cancel Case *@
<div class="modal  fade" id="cancelModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-info">
                <div class="modal-dark modal-title text-white" id="exampleModalLongTitle">
                    Confirm Cancellation
                </div>
                <button type="button" class="btn" aria-label="Close" data-bs-dismiss="modal">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"
                         fill="#FFFFFF">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z" />
                    </svg>
                </button>
            </div>
            <form>
                <div class="modal-body">
                    <span class="modal-head">Patient Name : <b style="color: var(--primary);">@Model.PatientName</b></span>
                    <div class="modal-flex my-3">

                        <div class="form-floating mt-3">
                            <select class="form-select" id="cancelModalCaseTag">
                                <option disabled selected value="0"> -- select casetag -- </option>

                                @foreach (var casetag in Model.casetags)
                                {
                                    <option value="@casetag.Casetagid">@casetag.Name</option>
                                }
                            </select>
                            <label for="cancelModalCaseTag">Reasons for Cancellation</label>
                        </div>

                        <div class="form-floating mt-3">
                            <input type="text" asp-for="RequestId" id="cancelCaseRequestId" hidden />
                            <input type="text" class="form-control" id="cancelCaseNotes">
                            <label for="cancelCaseNotes">Provide Additional Notes</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancel-modal-submit-btn" type="button" class="btn btn-info text-white" data-bs-dismiss="modal">
                        Continue
                    </button>
                    <button type="button" class="btn cancel-btn" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>


<div class="container-fluid d-flex justify-content-center row ">

    <div class="col-8">

        <div class="d-flex justify-content-between mt-3">
            <div class="d-flex">
                @{
                    string dStatusText = "", requestTypeText = "", requestTypeColor = "";
                    int requestType = Model.RequestType;
                    int dashboardStatus = Model.DashboardStatus;

                    switch (requestType)
                    {
                        case 1:
                            requestTypeText = "Business";
                            requestTypeColor = "#e26277";
                            break;

                        case 2:
                            requestTypeText = "Patient";
                            requestTypeColor = "#5fbc61";
                            break;

                        case 3:
                            requestTypeText = "Family/Friend";
                            requestTypeColor = "#ed9124";
                            break;

                        case 4:
                            requestTypeText = "Concierge";
                            requestTypeColor = "#007fc6";
                            break;
                    }

                    switch (dashboardStatus)
                    {
                        case 1:
                            dStatusText = "New";
                            break;

                        case 2:
                            dStatusText = "Pending";
                            break;

                        case 3:
                            dStatusText = "Active";
                            break;

                        case 4:
                            dStatusText = "Conclude";
                            break;

                        case 5:
                            dStatusText = "To Close";
                            break;

                        case 6:
                            dStatusText = "Unpaid";
                            break;
                    }
                }
                <h4>@dStatusText Reservation</h4>
                <span class="ms-2 px-4 btn text-white fw-bold"
                      style="background-color: @requestTypeColor; border-radius: 30px;">@requestTypeText</span>
            </div>

            <a asp-controller="Admin" asp-action="Dashboard" class="btn btn-outline-info shadow-none night-mode-btn d-flex align-items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 -960 960 960">
                    <path d="m142-480 294 294q15 15 14.5 35T435-116q-15 15-35 15t-35-15L57-423q-12-12-18-27t-6-30q0-15 6-30t18-27l308-308q15-15 35.5-14.5T436-844q15 15 15 35t-15 35L142-480Z" />
                </svg>
                <span>Back</span>
            </a>

        </div>

        <form method="post">

            <div class="shadow p-3 dashboard-card mt-4">

                <h4>Patient Information </h4>
                <span class="m-0 fw-normal" style="color:grey;">ConfirmationNumber</span>
                <h4 class="text-info m-0">@Model.Confirmation</h4>

                <div class="row">

                    <div class="col-12">

                        <div class="form-floating mt-3">
                            <textarea asp-for="PatientNotes" style="height:100px" class="form-control" placeholder="Leave a comment here" disabled
                                      id="floatingTextarea2"></textarea>
                            <label for="floatingTextarea2">Patient Notes</label>
                        </div>

                    </div>

                </div>

                <hr class="mt-3 mb-0" />

                <div class="row">

                    <div class="col-md-6 col-12">
                        <div class="form-floating mt-3">
                            <input asp-for="PatientFirstName" class="form-control" placeholder="Leave a comment here" disabled
                                   id="floatingTextarea2">
                            <label for="floatingTextarea2">First Name</label>
                        </div>
                    </div>

                    <div class="col-md-6 col-12">
                        <div class="form-floating mt-3">
                            <input asp-for="PatientLastName" class="form-control" placeholder="Leave a comment here" disabled
                                   id="floatingTextarea2">
                            <label for="floatingTextarea2">Last Name</label>
                        </div>
                    </div>

                </div>


                <div class="row">

                    <div class="col-md-6 col-12">

                        <div class="form-floating mt-3">

                            <input asp-for="Dob" class="form-control" placeholder="Leave a comment here" type="date"
                                   id="floatingTextarea2" disabled>
                            <label for="floatingTextarea2">Date of Birth:</label>

                        </div>

                    </div>

                    <div class="col-md-5 col-12">

                        <div class="form-floating d-flex mt-3">
                            <input id="patient-phone-country" asp-for="CountryCode" hidden disabled />
                            <input id="patient-phone" class="py-4 form-control" type="tel" asp-for="PatientPhone" disabled />
                        </div>

                    </div>

                    <div class="col-1 mt-3">

                        <button type="button" class="btn btn-outline-info w-100 h-100" style="color: #10bce9;">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24" fill="currentColor" viewBox="0 -960 960 960" width="24">
                                <path d="M798-120q-125 0-247-54.5T329-329Q229-429 174.5-551T120-798q0-18 12-30t30-12h162q14 0 25 9.5t13 22.5l26 140q2 16-1 27t-11 19l-97 98q20 37 47.5 71.5T387-386q31 31 65 57.5t72 48.5l94-94q9-9 23.5-13.5T670-390l138 28q14 4 23 14.5t9 23.5v162q0 18-12 30t-30 12ZM241-600l66-66-17-94h-89q5 41 14 81t26 79Zm358 358q39 17 79.5 27t81.5 13v-88l-94-19-67 67ZM241-600Zm358 358Z" />
                            </svg>
                        </button>

                    </div>

                </div>


                <div class="row">

                    <div class="col-md-6 col-12">

                        <div class="form-floating mt-3">
                            <input type="text" class="form-control" id="floatingInputemail" placeholder="name@example.com" asp-for="PatientEmail" oninput="checkUser()" disabled />
                            <label for="floatingInputemail">Email address</label>
                        </div>

                    </div>

                </div>

        </form>

        <h4 class="mt-4">Location Information</h4>

        <div class="row">

            <div class="col-md-6 col-12">
                <div class="form-floating mt-3">
                    <input asp-for="Region" class="form-control" placeholder="Leave a comment here" disabled
                           id="floatingTextarea2"></input>
                    <label for="floatingTextarea2">Region</label>
                </div>
            </div>

            <div class="col-md-5 col-12">
                <div class="form-floating mt-3">
                    <input asp-for="Address" class="form-control" placeholder="Leave a comment here" disabled></input>
                    <label for="floatingTextarea2">Name/Address</label>
                </div>
            </div>

            <div class="col-1 mt-3">

                @* @{
                string googleMapsLink = "";
                }

                @if(Model.street != null && Model.state != null && Model.city != null && Model.zip !=  null)
                {
                googleMapsLink = $"https://www.google.com/maps/search/?api=1&query={Uri.EscapeDataString(Model?.street).ToString()},{Uri.EscapeDataString(Model?.city).ToString()},{Uri.EscapeDataString(Model?.state).ToString()},{Uri.EscapeDataString(Model?.zip).ToString()}";
                }  *@

                <a class="btn btn-outline-info w-100 h-100 align-items-center d-flex justify-content-center" style="color: #10bce9;">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" fill="#10bce9" width="24"><path d="M480-480q33 0 56.5-23.5T560-560q0-33-23.5-56.5T480-640q-33 0-56.5 23.5T400-560q0 33 23.5 56.5T480-480Zm0 294q122-112 181-203.5T720-552q0-109-69.5-178.5T480-800q-101 0-170.5 69.5T240-552q0 71 59 162.5T480-186Zm0 106Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q127 0 223.5 89T800-552q0 100-79.5 217.5T480-80Zm0-480Z" /></svg>
                </a>

            </div>

            <div class="col-md-6 col-12">

                <div class="form-floating mt-3">

                    <input asp-for="Rooms" class="form-control" placeholder="Leave a comment here" disabled
                           id="floatingTextarea2">
                    <label for="floatingTextarea2">Rooms(Optional)</label>

                </div>

            </div>

        </div>

        <div class="d-flex justify-content-end mt-3">

            @if (dashboardStatus == 1)
            {
                <button type="button" data-bs-toggle="modal" data-bs-target="#assignModal" class="btn py-2 px-4" style="background-color: #10bce9; color: white;">
                    Assign
                </button>

                <a asp-controller="Admin" asp-action="ViewNotes" class="btn py-2 px-4 ms-3" style="background-color: #10bce9; color: white;">
                    View Notes
                </a>

                <button id="cancelBtn" data-bs-toggle="modal" data-bs-target="#cancelModal" type="button" class="btn py-2 px-4 ms-3 bg-danger" style="background-color: #10bce9; color: white;">
                    Cancel
                </button>
            }
            else
            {
                <a asp-controller="Admin" asp-action="ViewNotes" class="btn py-2 px-4 ms-3" style="background-color: #10bce9; color: white;">
                    View Notes
                </a>
            }


        </div>

    </div>

    <div style="height: 20px;"></div>

</div>


<script>

    $('.admin-tab').removeClass("active");
    $('#dashboard-tab').addClass("active");

</script>

<script>

    $('#cancel-modal-submit-btn').on('click', function () {

        $.ajax({
            url: "/Admin/CancelCaseModal",
            data: { reason: $('#cancelModalCaseTag').val(), notes: $('#cancelCaseNotes').val(), requestid: $('#cancelCaseRequestId').val() },
            type: 'POST',
            success: function (result) {
                location.reload();
            },
            error: function (error) {
                console.log(error);
                alert('Error Cancelling Request')
            },
        });

    });

    $('#assign-modal-submit-btn').on('click', function () {

        $.ajax({
            url: "/Admin/AssignCaseModal",
            data: { notes: $('#assignCaseNotes').val(), requestid: $('#assignCaseRequestId').val(), physicianid: $('#assignCasePhysician').val() },
            type: 'POST',
            success: function (result) {
                location.reload();
            },
            error: function (error) {
                console.log(error);
                alert('Error Cancelling Request')
            },
        });

    });
</script>
<script>

    function editDetails() {

        var inputs = document.querySelectorAll('input ,  textarea');
        for (var i = 0; i < inputs.length; i++) {
            inputs[i].disabled = false;
        }

        var selects = document.getElementsByTagName("select");
        for (var i = 0; i < selects.length; i++) {
            selects[i].disabled = false;
        }

        var editBtn = document.getElementById("editBtn");
        editBtn.style.display = "none";

        var saveBtn = document.getElementById("saveBtn");
        saveBtn.style.display = "block";

    }

    const phoneInputField = document.getElementById("patient-phone");
    var patientPhoneInput = window.intlTelInput(phoneInputField, {
        utilsScript:
            "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        preferredCountries: ["in"],
        separateDialCode: true,
        initialCountry: "in"
    });


    function changeCountryCode() {
        var countryCode = document.getElementById("patient-phone-country");
        countryCode.value = patientPhoneInput.getSelectedCountryData().dialCode;
        console.log(countryCode.value);
    }

</script>
